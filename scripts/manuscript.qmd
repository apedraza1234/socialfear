---
title: "Social Conditions of Fear"
author:
  - Alejandra Pedraza
  - W. Jamie Yang
abstract: "TBW" # this is where abstract should be pasted 
format: html
toc: true
toc-location: left
toc-title: Table of Contents
highlight-style: pygments
editor: visual
execute:
  eval: true # change to false before final submission
  echo: true
  message: false
  warning: false
fig-width: 6.5
fig-height: 8
code-fold: true
code-summary: "View Code"
embed-resources: true
bibliography: references.bib
link-citations: true
---

# Introduction

# Methods

# Results

# Discussion

\newpage

# References

\newpage

# Appendices

## Appendix 1: Codebook

### Dependent Variable

-   **fear**: Is there any area right around here--that is, within a mile--where you would be afraid to walk alone at night?

### Independent Variables

#### Individual-Level

-   **born**: Were you born in this country?

-   **age**

-   **sexnow1**: Do you describe yourself as male, female, or transgender? *This is self-described gender.*

-   **sex**: Code respondent's sex (*This is gender presentation as interpreted by the interviewer).*

-   **sexornt**: Which of the following best describes you?

-   **racerank1**: If you had to choose, which of these races do you identify most with? *Kept this race variable here instead of "race" because it allows more heterogeneity within group.*

-   **hispanic**: Are you Spanish, Hispanic, or Latino/Latina? IF YES: Which group are you from?

-   **degree**: Respondent's degree.

-   **uscitzn**: Are you a US citizen?

-   **dwelown**: (Do you/Does your family) own your (home/apartment), pay rent, or what?

#### Community-Level

-   **attend**: How often do you attend religious services?

-   **raclive**: Are there any ("whites" for black respondents, "blacks" for non-black respondents) living in this neighborhood now?

-   **happy**: Taken all together, how would you say things are these days--would you say that you are very happy, pretty happy, or not too happy?

-   **health**: Would you say your own health, in general, is excellent, good, fair, or poor?

-   **helpful**: Would you say that most of the time people try to be helpful, or that they are mostly just looking out for themselves?

-   **fair**: Do you think most people would try to take advantage of you if they got a chance, or would they try to be fair?

-   **trust**: Generally speaking, would you say that most people can be trusted or that you can't be too careful in dealing with people?

-   **partnrs5**: since February/March 2015, and including the past 12 months, how many sex partners have you had in that five year period?

## Appendix II: Data Cleaning

```{r}
#| label: load-packages
#| include: false

library(tidyverse)
library(dplyr)
library(tidyr)
library(here)
library(rio)
library(janitor)
library(knitr)
library(kableExtra)
library(mice)
library(forcats)
library(ggplot2)
library(RColorBrewer)
```

```{r}
#| label: load-data 

gss <- import(here("data", "GSS.xlsx")) %>%
  as_tibble() %>% 
  clean_names()

```

```{r}
#| label: filtering-2022-data

gss2022 <- gss %>% 
  filter(year == "2022") 

```

```{r}
#| label: select-variables

data <- gss2022 %>% 
    select(age, sex, sexnow1, sexornt, degree, attend, raclive, happy, health, helpful, fair, trust, fear, partnrs5, racerank1, uscitzn, dwelown) 

```

The GSS codes missing data as either ".i: Inapplicable", ".n: No answer", ".d: Do not Know/Cannot Choose", and ".s: Skipped on Web. For the purposes of this project, we are considering all of the above as missing values. For our next steps, we need to reexamine this decision as".i: Inapplicable" is a valid skip and needs to be accounted for accordingly.

In the following code chunk, we recode the aforementioned indicators as NAs. This is a necessary first step to run mice imputations.

```{r}
#| label: coding-missing-data-as-NAs 

missing_vec <- c(".i:  Inapplicable", ".n:  No answer", ".d:  Do not Know/Cannot Choose", ".s:  Skipped on Web")
	
tidydata <- data %>% 
  mutate(across(c(age, sex, sexnow1, sexornt, degree, attend, raclive, happy, health, helpful, fair, trust, fear, partnrs5, racerank1, uscitzn, dwelown), 
                ~ifelse(. %in% missing_vec, NA_character_, .)))

```

First we filtered out all NAs from our dependent variable, fear.

Informed by theory, race/ ethnicity is an important covariate for our models. First, we sought to create a combined race variable from the variables "race" and "hispanic." After looking at the data, we saw that the options for the race variable were "Black, White, Other." This does not provide the control we need. So, we opted to use the "racerank1" variable, because participants were able to select from 16 different options: White, Black or African-American, Asian Indian, Chinese, Filipino, Japanese, Korean, Vietnamese, Other Asian, Guamanian or Chamorro, Samoan, Other Pacific Islander, Some other race, and Hispanic. We factored and recoded these to White, Black, Hispanic, Asian, NHPI (Native Hawaiian or Pacific Islander), AIAN (American Indian, Alaska Native), and Other. We understand that these categories are problematic and contentious, however they are the standard with quantitative data.

Then we factored and recoded selected variables for our analysis. It was important to not have any variables as character strings, otherwise mice imputations would not work.

```{r}
#| label: factoring-recoding-variables 

tidydata <- tidydata %>% 
  filter(!is.na(fear)) %>% 
  mutate(age = as.numeric(age)) %>% 
  mutate(raclive = as.factor(raclive)) %>% 
  mutate(sexnow1 = as.factor(sexnow1)) %>% 
  mutate(fear = factor(case_when(fear == "NO" ~ "no",
                                 fear == "YES" ~ "yes"))) %>% 
  mutate(racecombo = 
           factor(case_when(racerank1 == "White" ~ "White",
                     racerank1 == "Black or African-American" ~ "Black",
                     racerank1 == "Hispanic" ~ "Hispanic",
                     racerank1 == "Asian Indian" | racerank1 ==  "Chinese" |
                       racerank1 ==  "Filipino" | racerank1 ==  "Japanese" | 
                       racerank1 ==  "Korean" |  racerank1 ==  "Vietnamese" |
                       racerank1 ==  "Other Asian" ~ "Asian",
                     racerank1 == "American Indian or Alaska Native" ~ "AIAN",
                     racerank1 == "Guamanian or Chamorro" | racerank1 == "Samoan" |
                       racerank1 == "Other Pacific Islander" ~ "NHPI",
                      racerank1 == "Some other race" ~ "Other"))) %>% 
  mutate(racecombo = fct_relevel(racecombo, 
              "White",
              "Black", 
              "Asian",
              "Hispanic",
              "AIAN",
              "NHPI",
              "Other")) %>%   
  mutate(partnrs5 = 
           factor(case_when(partnrs5 == "NO PARTNERS" ~ "0",
                            partnrs5 == "1 PARTNER" | partnrs5 == "2 PARTNERS" |
                              partnrs5 == "3 PARTNERS" | 
                              partnrs5 == "4 PARTNERS" ~ "Less than 5",
                            partnrs5 == "5-10 PARTNERS" ~ "5-10",
                            partnrs5 == "11-20 PARTNERS" ~ "11-20",
                            partnrs5 == "21-100 PARTNERS" ~ "21-100",
                            partnrs5 == "MORE THAN 100 PARTNERS" ~ "100 or more",
                            .default = NA))) %>%
  mutate(partnrs5 = fct_relevel(partnrs5,
                                "0",
                                "Less than 5",
                                "5-10",
                                "11-20",
                                "21-100",
                                "100 or more")) %>%
  mutate(uscitzn = 
           factor(case_when(uscitzn == "A u.s. citizen" | uscitzn == "A u.s. citizen born in puerto rico, the u.s. virgin islands, or the northern marianas islands (if volunteered)" |
                       uscitzn == "Born outside of the u.s. to parents who were u.s. citizens at that time (if volunteered)" ~ "Yes",
                     uscitzn == "Not a u.s. citizen" ~ "No",
                     .default = NA))) %>% 
   mutate(dwelown =
           factor(case_when(dwelown == "Own or is buying" ~ "Owner",
                            dwelown == "Pays rent" ~ "Renter",
                            dwelown == "Other" ~ "Other"))) %>% 
  mutate(degree = fct_relevel(degree, 
                              "Less than high school",
                              "High school",
                              "Associate/junior college",
                              "Bachelor's",
                              "Graduate")) %>% 
  mutate(attend = fct_relevel(attend, 
                              "Never",
                              "Less than once a year",
                              "About once or twice a year",
                              "2-3 times a month",
                              "Nearly every week",
                              "Every week",
                              "Several times a week")) %>% 
  mutate(happy = fct_relevel(happy, 
                             "Not too happy",
                             "Pretty happy",
                             "Very happy",)) %>% 
  mutate(health = fct_relevel(health, 
                              "Poor",
                              "Fair",
                              "Good",
                              "Excellent")) %>% 
  mutate(helpful = fct_relevel(helpful, 
                               "Looking out for themselves",
                               "Try to be helpful",
                               "Depends")) %>% 
  mutate(fair = fct_relevel(fair, 
                            "Would take advantage of you",
                            "Would try to be fair",
                            "Depends")) %>% 
  mutate(trust = fct_relevel(trust, 
                             "Can't be too careful",
                             "Can trust",
                             "Depends")) 

```

Once our data was tidy, we selected the variables we would be using for our analysis.

```{r}
#| label: subset-data

gss_subset <- tidydata %>% 
  select(age, sexnow1, racecombo, uscitzn, degree, attend, raclive, happy, health, partnrs5, fear) 
```

To deal with the large amount of missing values, we ran mice imputations. In the code below we create a new dataset with the imputed values. We will use this dataset in our next stage to run various models.

```{r}
#| label: mice-imputation
#| eval: false

complete5 <- mice(gss_subset, 
                 m = 5, 
                 seed = 25)

summary(complete(complete5, 1))

temp5 <- complete(complete5, action = "long", include = TRUE)

tidydata_complete <- as.mids(temp5)

save(tidydata_complete, file = "data/tidydata_complete.RData")

```

\newpage

# Tables and Figures

```{r}
#| label: tbl-FearRaceSex
#| tbl-cap: Mean fear by race and gender calculated from respondents affirmative answer to GSS question, Is there any area right around here--that is, within a mile--where you would be afraid to walk alone at night? 

gss_subset %>% 
  filter(!is.na(racecombo)) %>% 
  filter(racecombo != "Other") %>% 
  filter(!is.na(sexnow1)) %>% 
  filter(sexnow1 != "None of these") %>% 
  pivot_longer(
    cols = fear,
    names_to = "fear",
    values_to = "answer") %>% 
  select(racecombo, answer, sexnow1) %>% 
  mutate(fear = as.numeric(case_when(answer == "no" ~ "0",
                                 answer == "yes" ~ "1"))) %>% 
  select(racecombo, fear, sexnow1) %>% 
  group_by(racecombo, sexnow1) %>% 
  summarize(mean_fear = mean(fear)) %>% 
  pivot_wider(
    names_from = sexnow1,
    values_from = mean_fear
  ) %>% 
  kable(caption = "Social Fear by Race and Gender",
        col.names = c("Race", "Female", "Male", "Transgender"),
        digits = 3) %>% 
  kableExtra::row_spec(0:6, background = "white") 
```

```{r}
#| label: fig-FearRaceGender
#| fig-cap: Bar graph showing the percentage of respondants, by race and gender, that responded affirmative to GSS question, Is there any area right around here--that is, within a mile--where you would be afraid to walk alone at night?

gss_subset %>% 
  filter(!is.na(racecombo)) %>% 
  filter(racecombo != "Other") %>% 
  filter(!is.na(sexnow1)) %>% 
  filter(sexnow1 != "None of these") %>% 
  group_by(racecombo, sexnow1) %>% 
  summarize(fear = sum(fear == "yes"), 
            n = n(),
            prop = fear/n) %>% 
  ggplot(aes(x = racecombo, y = prop)) +
  geom_col(aes(fill = sexnow1), position = "dodge") + 
  scale_fill_brewer(palette = "Purples") +
  scale_y_continuous(labels = scales::percent) +
  labs(title = "Social Fear by Race and Gender",
       subtitle = "Is social fear influenced by respondent's race and gender?",
       x = "Race",
       y = "Percentage of Respondents who Expressed Fear") +
  theme_bw() +
  guides(fill = guide_legend(title = "Gender")) 

```

```{r}
#| label: fig-FearRelgiousPart
#| fig-cap: Bar graph showing the percentage of respondants, by degree of participation in religious activities, that responded affirmative to GSS question, Is there any area right around here--that is, within a mile--where you would be afraid to walk alone at night?

gss_subset %>% 
  filter(!is.na(attend)) %>% 
  group_by(attend) %>% 
  summarize(fear = sum(fear == "yes"), 
            n = n(),
            prop = fear/n) %>% 
  ggplot(aes(x = attend, y = prop, fill = attend)) +
  geom_col() + 
  scale_fill_brewer(palette = "Blues") +
  scale_y_continuous(labels = scales::percent) +
  labs(title = "Social Fear by Relgious Participation",
       subtitle = "Is social fear influenced by religious participation?",
       x = "Religious Participation",
       y = "Percentage of Respondents who Expressed Fear") +
  theme_bw() +
  guides(fill = "none") +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1))

```

```{r}
#| label: fig-FearHappiness
#| fig-cap: Bar graph showing the percentage of respondants, by happiness levels, that responded affirmative to GSS question, Is there any area right around here--that is, within a mile--where you would be afraid to walk alone at night?

gss_subset %>% 
  filter(!is.na(happy)) %>% 
  group_by(happy) %>% 
  summarize(fear = sum(fear == "yes"), 
            n = n(),
            prop = fear/n) %>% 
  ggplot(aes(x = happy, y = prop, fill = happy)) +
  geom_col() + 
  scale_fill_brewer(palette = "PuBuGn") +
  scale_y_continuous(labels = scales::percent) +
  labs(title = "Social Fear by Happiness Level",
       subtitle = "Is social fear influenced by level of happiness?", 
       x = "Happiness Level",
       y = "Percentage of Respondents who Expressed Fear") +
  theme_bw() +
  guides(fill = "none") +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1))
```

```{r}
#| label: fig-FearNeighborhood
#| fig-cap: Bar graph showing the percentage of respondants, based on race and neighborhood diversity, that responded affirmative to GSS question, Is there any area right around here--that is, within a mile--where you would be afraid to walk alone at night?

gss_subset %>% 
  filter(!is.na(racecombo)) %>% 
  filter(racecombo != "Other") %>% 
  filter(!is.na(raclive)) %>%  
  group_by(racecombo, raclive) %>% 
  summarize(fear = sum(fear == "yes"), 
            n = n(),
            prop = fear/n) %>% 
  ggplot(aes(x = racecombo, y = prop)) +
  geom_col(aes(fill = raclive), position = "dodge") + 
  scale_fill_brewer(palette = "Set2") +
  scale_y_continuous(labels = scales::percent) +
  labs(title = "Social Fear by Race and Neighborhood Diversity",
       subtitle = "Is social fear influenced by respondent's race and their neighborhood's diversity?",
       x = "Race",
       y = "Percentage of Respondents who Expressed Fear") +
  theme_bw() +
  guides(fill = guide_legend(title = "Residential Diversity")) 
```

```{r}
#| label: fig-FearHealth
#| fig-cap: Bar graph showing the percentage of respondants, by health levels, that responded affirmative to GSS question, Is there any area right around here--that is, within a mile--where you would be afraid to walk alone at night?

gss_subset %>% 
  filter(!is.na(health)) %>% 
  group_by(health) %>% 
  summarize(fear = sum(fear == "yes"), 
            n = n(),
            prop = fear/n) %>% 
  ggplot(aes(x = health, y = prop, fill = health)) +
  geom_col() + 
  scale_fill_brewer(palette = "PuRd") +
  scale_y_continuous(labels = scales::percent) +
  labs(title = "Social Fear by Health Level",
       subtitle = "Is social fear influenced by health?", 
       x = "Health Level",
       y = "Percentage of Respondents who Expressed Fear") +
  theme_bw() +
  guides(fill = "none") +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1))
```

```{r}
#| label: fig-FearPartnersGender
#| fig-cap: Bar graph showing the percentage of respondants, by gender and number of sexual partners in the past 5 years, that responded affirmative to GSS question, Is there any area right around here--that is, within a mile--where you would be afraid to walk alone at night?

gss_subset %>% 
  filter(!is.na(partnrs5)) %>% 
  filter(!is.na(sexnow1)) %>% 
  filter(sexnow1 != "None of these") %>% 
  group_by(partnrs5, sexnow1) %>% 
  summarize(fear = sum(fear == "yes"), 
            n = n(),
            prop = fear/n) %>% 
  ggplot(aes(x = partnrs5, y = prop)) +
  geom_col(aes(fill = sexnow1), position = "dodge") + 
  scale_fill_brewer(palette = "Spectral") +
  scale_y_continuous(labels = scales::percent) +
  labs(title = "Social Fear by Gender and Sexual Partners",
       subtitle = "Is social fear influenced by respondent's gender and number of sexual partners?",
       x = "Number of Sexual Partners in the Past 5 Years",
       y = "Percentage of Respondents who Expressed Fear") +
  theme_bw() +
  guides(fill = guide_legend(title = "Gender")) 

```
